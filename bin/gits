#!/usr/bin/perl

use Cwd;
my $wd = getcwd;

my @args = @ARGV;

my $command = shift @args;

my @repos;
while(my $str = pop @args){
      if(-d $str && -d "$str/.git"){
	    unshift @repos, $str;
      }else{
	    push @args, $str;
	    last;
      }
}

unless(@repos){
      print STDERR "No repos specified. Apply to all? [Y/N]: \n";
      my $q = <STDIN>;
      exit unless $q =~ /^\s*Y/i;

      foreach my $str ( glob('*') ){
	    if(-d $str && -d "$str/.git"){
		  push @repos, $str;
	    }
      }
}

foreach my $repo (@repos){
      print "\n =================== $repo ===================\n";
      chdir "$wd/$repo" or die "failed to chdir $wd/$repo";
      system('git',$command,@args) and die $!;
}
